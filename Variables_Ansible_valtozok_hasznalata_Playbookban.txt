# El≈ëk√©sz√ºletek ‚Äì √∫j projektp√©ld√°ny
cp -r exercise7/ exercise8
cd exercise8

# Playbook: db.yaml ‚Äì v√°ltoz√≥kkal b≈ëv√≠tve
nano db.yaml

- name: DBserver setup
  hosts: dbservers
  become: yes

  vars:
    dbname: eletric
    dbuser: current
    dbpass: tesla

  tasks:

    - name: Print dbname variable
      debug:
        msg: "The dbname is {{ dbname }}"

    - name: Print dbuser variable
      debug:
        var: dbuser

    - name: Install mariadb-server
      ansible.builtin.yum:
        name: mariadb-server
        state: present

    - name: Install PyMySQL
      ansible.builtin.yum:
        name: python3-PyMySQL
        state: present

    - name: Start mariadb service
      ansible.builtin.service:
        name: mariadb
        state: started
        enabled: yes

    - name: Create a new database
      community.mysql.mysql_db:
        name: "{{ dbname }}"
        state: present
        login_unix_socket: /var/lib/mysql/mysql.sock

    - name: Create database user
      community.mysql.mysql_user:
        name: "{{ dbuser }}"
        password: "{{ dbpass }}"
        priv: '*.*:ALL'
        state: present
        login_unix_socket: /var/lib/mysql/mysql.sock
      register: dbout  # üíæ V√ÅLTOZ√ìBA MENT√âS

    - name: Print dbout result
      debug:
        var: dbout

# Magyar√°zat ‚Äì mi t√∂rt√©nik itt?
vars szekci√≥
A vars: alatt v√°ltoz√≥kat defini√°lunk, amelyek √©rt√©kei k√©s≈ëbb sablon form√°ban ({{ variable_name }}) hivatkozhat√≥k.

vars:
  dbname: eletric
  dbuser: current
  dbpass: tesla

Ezut√°n ezeket a v√°ltoz√≥kat haszn√°ljuk az adatb√°zis √©s felhaszn√°l√≥ l√©trehoz√°s√°n√°l.

# debug modul
A debug: modul lehet≈ëv√© teszi, hogy v√°ltoz√≥k √©rt√©k√©t ki√≠rjuk fut√°s k√∂zben ‚Äì kiv√°l√≥ hibakeres√©shez!

- debug:
    var: dbuser

vagy:

- debug:
    msg: "The dbname is {{ dbname }}"

# register √©s visszajelz√©s
Az ansible.builtin.register kulcssz√≥val elmentj√ºk egy feladat kimenet√©t egy v√°ltoz√≥ba (dbout), majd azt a debug modullal ki√≠rjuk.
Ez seg√≠t p√©ld√°ul eld√∂nteni, hogy egy feladat sikeresen lefutott-e, √©s milyen inform√°ci√≥kat adott vissza.

# Futtat√°s
ansible-playbook db.yaml

Ha r√©szletesebb visszajelz√©st szeretn√©l:
ansible-playbook db.yaml -v
ansible-playbook db.yaml -vvv

N√©lk√ºl = name: accounts, V√°ltoz√≥val = name: "{{ dbname }}"
N√©lk√ºl = password: 123, V√°ltoz√≥val = password: "{{ dbpass }}"

√ñsszefoglalva: a v√°ltoz√≥k n√∂velik a rugalmass√°got, olvashat√≥s√°got √©s √∫jrahaszn√°lhat√≥s√°got. Ez az els≈ë l√©p√©s a dinamikus Ansible Playbook fel√©
